Sub teste()
    
    Sheets("Planilha1").Activate
'verificando se existe filtro ativo, caso nao exista o filtro e aplicado.
    If Not ActiveSheet.AutoFilterMode Then
        Range("B3", Cells(3, 2).End(xlToRight)).AutoFilter
    End If
    On Error Resume Next
    ActiveSheet.ShowAllData
'verifica tamanho dos dados preenchidos
    tam = (Cells(4, 12).End(xlToRight).Column - Cells(4, 11).Column) / 2
    For k = 1 To 6
        j = 10
        For i = 1 To tam
            ActiveSheet.Range("M:M").AutoFilter Field:=j + 2, Criteria1:=k
            j = j + 2
        Next
        lin_inicio = ActiveSheet.AutoFilter.Range.Offset(1).SpecialCells(xlCellTypeVisible).Row
        If Not IsEmpty(Cells(lin_inicio, 2).Value) Then
            If k < 4 Then
                Cells(lin_inicio, 37).Value = "CONTANTE ABAIXO"
            ElseIf k = 4 Then
                Cells(lin_inicio, 37).Value = "CONTANTE ESPERADO"
            ElseIf k > 4 Then
                Cells(lin_inicio, 37).Value = "CONTANTE ACIMA"
            End If
            Range("AK" & lin_inicio & ":AK" & Cells(lin_inicio, 2).End(xlDown).Row).SpecialCells(xlCellTypeVisible).FillDown
        End If
        On Error Resume Next
        ActiveSheet.ShowAllData
    Next
'defininado range de todos os dados
    Set rngAF = Range("B4:B" & Cells(4, 2).End(xlDown).Row)
'aplicando filtro
    ActiveSheet.Range("AK:AK").AutoFilter Field:=36, Criteria1:="="
'loop apenas nos dados filtrados
    For Each rngcell In rngAF.SpecialCells(xlCellTypeVisible)
        lin = rngcell.Row
        j = 11
        a = 0
        b = 0
        c = 0
        For i = 1 To tam
            If i = 1 Then
                ref1 = Cells(lin, j + 2).Value
            ElseIf i = tam Then
                ref2 = Cells(lin, j + 2).Value
            ElseIf Cells(lin, j + 2).Value = ref1 Then
                a = a + 1
            ElseIf Cells(lin, j + 2).Value < ref1 Then
                b = b + 1
            ElseIf Cells(lin, j + 2).Value > ref1 Then
                c = c + 1
            End If
            j = j + 2
        Next
        If ref1 = ref2 And b > 0 And c = 0 Then
            Cells(lin, 37).Value = "ATENÇÃO"
        ElseIf ref1 = ref2 And b = 0 And c > 0 Then
            Cells(lin, 37).Value = "POTENCIAL"
        Else
            Cells(lin, 37).Value = "#N/A"
        End If
    Next rngcell
End Sub
